<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL Mystery Vietnam üîç - H·ªçc SQL qua ƒêi·ªÅu tra V·ª• √Ån</title>
    <meta name="description" content="H·ªçc SQL mi·ªÖn ph√≠ qua 50 v·ª• √°n h√¨nh s·ª± t·∫°i Vi·ªát Nam. Tr·ªü th√†nh th√°m t·ª≠, vi·∫øt SQL ƒë·ªÉ ph√° √°n!">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=JetBrains+Mono:wght@400;500;600&family=Be+Vietnam+Pro:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- SQL.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
    
    <style>
        :root {
            --bg-dark: #0a0a0f;
            --bg-card: #12121a;
            --bg-card-hover: #1a1a25;
            --accent-gold: #d4af37;
            --accent-gold-dim: #9a7b1f;
            --accent-red: #8b0000;
            --accent-red-bright: #dc143c;
            --text-primary: #f5f5dc;
            --text-secondary: #a0a0a0;
            --text-dim: #606060;
            --border-color: #2a2a35;
            --success: #228b22;
            --success-bg: rgba(34, 139, 34, 0.15);
            --error: #dc143c;
            --error-bg: rgba(220, 20, 60, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* Noir film grain effect */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
            opacity: 0.03;
            pointer-events: none;
            z-index: 1000;
        }

        /* Header */
        header {
            background: linear-gradient(180deg, var(--bg-card) 0%, transparent 100%);
            padding: 1.5rem 1rem;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            position: relative;
        }

        header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent-gold), transparent);
        }

        .logo {
            font-family: 'Playfair Display', serif;
            font-size: clamp(1.5rem, 5vw, 3rem);
            font-weight: 900;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            background: linear-gradient(135deg, var(--accent-gold) 0%, #fff8dc 50%, var(--accent-gold) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 60px rgba(212, 175, 55, 0.3);
            margin-bottom: 0.3rem;
        }

        .tagline {
            font-size: clamp(0.7rem, 2vw, 1rem);
            color: var(--text-secondary);
            letter-spacing: 0.2em;
            text-transform: uppercase;
        }

        /* Stats Bar */
        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            padding: 0.8rem;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
        }

        .stat-value {
            color: var(--accent-gold);
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Navigation Tabs - Mobile */
        .mobile-tabs {
            display: none;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .tab-buttons {
            display: flex;
        }

        .tab-btn {
            flex: 1;
            padding: 1rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 0.9rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .tab-btn.active {
            color: var(--accent-gold);
            border-bottom-color: var(--accent-gold);
            background: rgba(212, 175, 55, 0.1);
        }

        /* Main Layout */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 1rem;
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 1rem;
        }

        /* Sidebar - Case List */
        .sidebar {
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 180px);
            position: sticky;
            top: 1rem;
        }

        .sidebar-header {
            padding: 1rem 1.2rem;
            background: linear-gradient(135deg, var(--accent-red) 0%, #5a0000 100%);
            border-bottom: 2px solid var(--accent-gold);
            flex-shrink: 0;
        }

        .sidebar-header h2 {
            font-family: 'Playfair Display', serif;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-section {
            padding: 0.8rem 1rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            gap: 0.4rem;
            flex-wrap: wrap;
            flex-shrink: 0;
        }

        .filter-btn {
            padding: 0.35rem 0.6rem;
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.75rem;
            transition: all 0.2s;
        }

        .filter-btn:hover, .filter-btn.active {
            background: var(--accent-gold);
            color: var(--bg-dark);
            border-color: var(--accent-gold);
        }

        .case-list {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem;
        }

        .case-item {
            padding: 0.8rem 1rem;
            margin: 0.4rem 0;
            background: var(--bg-dark);
            border-radius: 8px;
            border-left: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
        }

        .case-item:hover {
            background: var(--bg-card-hover);
            border-left-color: var(--accent-gold);
            transform: translateX(3px);
        }

        .case-item.active {
            background: var(--bg-card-hover);
            border-left-color: var(--accent-red-bright);
        }

        .case-item.solved {
            border-left-color: var(--success);
        }

        .case-item.solved::after {
            content: '‚úì';
            float: right;
            color: var(--success);
            font-weight: bold;
        }

        .case-number {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            color: var(--accent-gold);
            margin-bottom: 0.2rem;
        }

        .case-title {
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 0.2rem;
            line-height: 1.3;
        }

        .case-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.7rem;
            color: var(--text-dim);
        }

        .difficulty {
            color: var(--accent-gold);
            letter-spacing: -2px;
        }

        /* Main Content */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            min-width: 0;
        }

        /* Case Detail */
        .case-detail {
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .case-header {
            padding: 1.5rem;
            background: linear-gradient(135deg, #1a1a25 0%, var(--bg-card) 100%);
            border-bottom: 1px solid var(--border-color);
            position: relative;
        }

        .case-header::before {
            content: 'üîç';
            position: absolute;
            right: 1.5rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 3rem;
            opacity: 0.1;
        }

        .case-badge {
            display: inline-block;
            padding: 0.25rem 0.6rem;
            background: var(--accent-red);
            color: white;
            font-size: 0.7rem;
            font-weight: 600;
            border-radius: 4px;
            margin-bottom: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .case-detail h1 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(1.2rem, 3vw, 1.6rem);
            margin-bottom: 0.5rem;
            padding-right: 3rem;
        }

        .case-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.8rem;
            margin-top: 1rem;
        }

        .info-item {
            background: var(--bg-dark);
            padding: 0.6rem 0.8rem;
            border-radius: 6px;
        }

        .info-label {
            font-size: 0.65rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.2rem;
        }

        .info-value {
            font-weight: 500;
            font-size: 0.85rem;
            color: var(--text-primary);
        }

        .case-description {
            padding: 1.2rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .case-description h3 {
            font-size: 0.85rem;
            color: var(--accent-gold);
            margin-bottom: 0.6rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .case-description p {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .hint-box {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.1) 0%, rgba(212, 175, 55, 0.05) 100%);
            border: 1px solid var(--accent-gold-dim);
            border-radius: 8px;
            padding: 0.8rem 1rem;
            margin-top: 1rem;
        }

        .hint-box summary {
            cursor: pointer;
            color: var(--accent-gold);
            font-weight: 500;
            font-size: 0.9rem;
        }

        .hint-box p {
            margin-top: 0.6rem;
            color: var(--text-secondary);
            font-style: italic;
            font-size: 0.85rem;
        }

        /* Answer Section */
        .answer-section {
            padding: 1.2rem 1.5rem;
            background: var(--bg-dark);
            border-bottom: 1px solid var(--border-color);
        }

        .answer-section h3 {
            font-size: 0.85rem;
            color: var(--accent-gold);
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .answer-form {
            display: flex;
            gap: 0.8rem;
            flex-wrap: wrap;
        }

        .answer-input-group {
            flex: 1;
            min-width: 200px;
        }

        .answer-input-group label {
            display: block;
            font-size: 0.75rem;
            color: var(--text-dim);
            margin-bottom: 0.4rem;
        }

        .answer-input {
            width: 100%;
            padding: 0.8rem 1rem;
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: 'Be Vietnam Pro', sans-serif;
            transition: border-color 0.2s;
        }

        .answer-input:focus {
            outline: none;
            border-color: var(--accent-gold);
        }

        .answer-input::placeholder {
            color: var(--text-dim);
        }

        .btn-submit-answer {
            padding: 0.8rem 2rem;
            background: linear-gradient(135deg, var(--accent-red) 0%, #6b0000 100%);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
            align-self: flex-end;
        }

        .btn-submit-answer:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(139, 0, 0, 0.4);
        }

        .answer-result {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 8px;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .answer-result.show {
            display: block;
        }

        .answer-result.correct {
            background: var(--success-bg);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .answer-result.wrong {
            background: var(--error-bg);
            border: 1px solid var(--error);
            color: var(--error);
        }

        .answer-result h4 {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .answer-result p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Quick Actions */
        .quick-actions {
            padding: 1rem 1.5rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .quick-query {
            padding: 0.5rem 0.8rem;
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.75rem;
            transition: all 0.2s;
        }

        .quick-query:hover {
            border-color: var(--accent-gold);
            color: var(--accent-gold);
        }

        /* SQL Editor */
        .sql-section {
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .sql-header {
            padding: 0.8rem 1.2rem;
            background: var(--bg-dark);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .sql-header h3 {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--accent-gold);
        }

        .btn-group {
            display: flex;
            gap: 0.5rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.8rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-gold) 0%, var(--accent-gold-dim) 100%);
            color: var(--bg-dark);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-card-hover);
            color: var(--text-primary);
        }

        .kbd {
            display: none;
            padding: 0.15rem 0.4rem;
            background: rgba(0,0,0,0.3);
            border-radius: 3px;
            font-size: 0.7rem;
        }

        #sql-editor {
            width: 100%;
            min-height: 120px;
            padding: 1rem;
            background: #0d0d12;
            border: none;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            resize: vertical;
            outline: none;
            line-height: 1.5;
        }

        #sql-editor::placeholder {
            color: var(--text-dim);
        }

        /* Results */
        .results-section {
            padding: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.8rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .results-header h4 {
            color: var(--text-secondary);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .results-stats {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-dim);
        }

        .results-table-wrapper {
            overflow-x: auto;
            max-height: 350px;
            overflow-y: auto;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            -webkit-overflow-scrolling: touch;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8rem;
        }

        .results-table th {
            background: var(--bg-dark);
            padding: 0.7rem 0.8rem;
            text-align: left;
            font-weight: 600;
            color: var(--accent-gold);
            border-bottom: 2px solid var(--accent-gold-dim);
            position: sticky;
            top: 0;
            white-space: nowrap;
            font-size: 0.75rem;
        }

        .results-table td {
            padding: 0.6rem 0.8rem;
            border-bottom: 1px solid var(--border-color);
            max-width: 250px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .results-table tr:hover td {
            background: var(--bg-card-hover);
        }

        .error-message {
            background: var(--error-bg);
            border: 1px solid var(--error);
            border-radius: 8px;
            padding: 1rem;
            color: var(--error);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            word-break: break-word;
        }

        .success-message {
            background: var(--success-bg);
            border: 1px solid var(--success);
            border-radius: 8px;
            padding: 1rem;
            color: var(--success);
            text-align: center;
            font-size: 1rem;
        }

        /* Schema Reference */
        .schema-section {
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .schema-header {
            padding: 0.8rem 1.2rem;
            background: var(--bg-dark);
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .schema-header h3 {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .schema-content {
            padding: 1rem;
            display: none;
            max-height: 400px;
            overflow-y: auto;
        }

        .schema-content.show {
            display: block;
        }

        .schema-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 0.8rem;
        }

        .schema-table {
            background: var(--bg-dark);
            border-radius: 6px;
            overflow: hidden;
        }

        .schema-table-name {
            padding: 0.5rem 0.8rem;
            background: var(--accent-gold-dim);
            color: var(--bg-dark);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .schema-columns {
            padding: 0.4rem 0.6rem;
            font-size: 0.65rem;
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
        }

        .schema-columns div {
            padding: 0.15rem 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Welcome Screen */
        .welcome-screen {
            text-align: center;
            padding: 3rem 1.5rem;
        }

        .welcome-screen h2 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(1.5rem, 4vw, 2rem);
            margin-bottom: 1rem;
        }

        .welcome-screen p {
            color: var(--text-secondary);
            max-width: 500px;
            margin: 0 auto 1.5rem;
            font-size: 0.95rem;
        }

        .welcome-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
            margin-top: 1.5rem;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }

        .loading-spinner {
            width: 35px;
            height: 35px;
            border: 3px solid var(--border-color);
            border-top-color: var(--accent-gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 0.8rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 1.5rem 1rem;
            color: var(--text-dim);
            font-size: 0.8rem;
            border-top: 1px solid var(--border-color);
            margin-top: 1rem;
        }

        footer a {
            color: var(--accent-gold);
            text-decoration: none;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-dark);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-dim);
        }

        /* ==================== RESPONSIVE ==================== */
        
        /* Tablet */
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 280px 1fr;
            }
            
            .sidebar {
                height: calc(100vh - 160px);
            }
        }

        /* Mobile */
        @media (max-width: 768px) {
            .mobile-tabs {
                display: block;
            }

            .container {
                grid-template-columns: 1fr;
                padding: 0;
                gap: 0;
            }

            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                height: 100vh;
                border-radius: 0;
                z-index: 200;
                display: none;
            }

            .sidebar.show {
                display: flex;
            }

            .sidebar-close {
                display: block;
                position: absolute;
                top: 1rem;
                right: 1rem;
                background: none;
                border: none;
                color: white;
                font-size: 1.5rem;
                cursor: pointer;
                z-index: 10;
            }

            .main-content {
                padding: 0.5rem;
            }

            .main-content.hidden {
                display: none;
            }

            .case-header {
                padding: 1rem;
            }

            .case-header::before {
                display: none;
            }

            .case-detail h1 {
                padding-right: 0;
            }

            .case-info {
                grid-template-columns: repeat(2, 1fr);
            }

            .case-description,
            .answer-section,
            .quick-actions {
                padding: 1rem;
            }

            .answer-form {
                flex-direction: column;
            }

            .answer-input-group {
                min-width: 100%;
            }

            .btn-submit-answer {
                width: 100%;
            }

            .sql-header {
                flex-direction: column;
                align-items: stretch;
            }

            .btn-group {
                justify-content: space-between;
            }

            .btn {
                flex: 1;
                justify-content: center;
            }

            #sql-editor {
                min-height: 100px;
                font-size: 14px;
            }

            .results-section {
                padding: 0.8rem;
            }

            .schema-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .kbd {
                display: none !important;
            }

            .stats-bar {
                gap: 1rem;
                padding: 0.6rem;
            }

            .stat-item {
                font-size: 0.75rem;
            }

            footer {
                padding: 1rem;
            }
        }

        /* Small Mobile */
        @media (max-width: 480px) {
            header {
                padding: 1rem 0.5rem;
            }

            .case-info {
                grid-template-columns: 1fr;
            }

            .quick-query {
                font-size: 0.7rem;
                padding: 0.4rem 0.6rem;
            }

            .schema-grid {
                grid-template-columns: 1fr;
            }

            .results-table {
                font-size: 0.7rem;
            }

            .results-table th,
            .results-table td {
                padding: 0.5rem;
            }
        }

        /* Desktop - show keyboard hints */
        @media (min-width: 769px) {
            .kbd {
                display: inline-block;
            }

            .sidebar-close {
                display: none;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">SQL Mystery Vietnam</div>
        <div class="tagline">H·ªçc SQL qua 50 V·ª• √Ån H√¨nh S·ª±</div>
    </header>

    <div class="stats-bar">
        <div class="stat-item">
            <span>üìÅ V·ª• √°n:</span>
            <span class="stat-value">50</span>
        </div>
        <div class="stat-item">
            <span>‚úÖ ƒê√£ ph√°:</span>
            <span class="stat-value" id="solved-count">0</span>
        </div>
        <div class="stat-item">
            <span>üìä Ti·∫øn ƒë·ªô:</span>
            <span class="stat-value" id="progress-percent">0%</span>
        </div>
    </div>

    <!-- Mobile Tabs -->
    <nav class="mobile-tabs">
        <div class="tab-buttons">
            <button class="tab-btn active" data-tab="cases" onclick="showTab('cases')">üìÅ V·ª• √°n</button>
            <button class="tab-btn" data-tab="investigate" onclick="showTab('investigate')">üîç ƒêi·ªÅu tra</button>
            <button class="tab-btn" data-tab="sql" onclick="showTab('sql')">üíª SQL</button>
        </div>
    </nav>

    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <button class="sidebar-close" onclick="closeSidebar()">‚úï</button>
            <div class="sidebar-header">
                <h2>üìÅ H·ªì S∆° V·ª• √Ån</h2>
            </div>
            <div class="filter-section">
                <button class="filter-btn active" data-filter="all">T·∫•t c·∫£</button>
                <button class="filter-btn" data-filter="1">‚≠ê</button>
                <button class="filter-btn" data-filter="2">‚≠ê‚≠ê</button>
                <button class="filter-btn" data-filter="3">‚≠ê‚≠ê‚≠ê</button>
                <button class="filter-btn" data-filter="4">‚≠ê‚≠ê‚≠ê‚≠ê</button>
                <button class="filter-btn" data-filter="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</button>
            </div>
            <div class="case-list" id="case-list">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>ƒêang t·∫£i d·ªØ li·ªáu...</p>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content" id="main-content">
            <!-- Case Detail -->
            <section class="case-detail" id="case-detail">
                <div class="welcome-screen">
                    <h2>üïµÔ∏è Ch√†o m·ª´ng Th√°m t·ª≠!</h2>
                    <p>S·ª≠ d·ª•ng SQL ƒë·ªÉ ƒëi·ªÅu tra v√† t√¨m ra hung th·ªß trong 50 v·ª• √°n. Ch·ªçn m·ªôt v·ª• √°n ƒë·ªÉ b·∫Øt ƒë·∫ßu cu·ªôc ƒëi·ªÅu tra c·ªßa b·∫°n.</p>
                    
                    <div class="welcome-actions">
                        <span class="quick-query" onclick="runQuickQuery('SELECT id, title, case_type, difficulty FROM cases ORDER BY difficulty LIMIT 10')">üéØ Xem 10 v·ª• √°n d·ªÖ nh·∫•t</span>
                        <span class="quick-query" onclick="runQuickQuery('SELECT name FROM sqlite_master WHERE type=\\'table\\'')">üìã Li·ªát k√™ c√°c b·∫£ng</span>
                    </div>
                </div>
            </section>

            <!-- SQL Editor -->
            <section class="sql-section" id="sql-section">
                <div class="sql-header">
                    <h3>üíª SQL Console</h3>
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="clearEditor()">üóëÔ∏è X√≥a</button>
                        <button class="btn btn-primary" onclick="executeSQL()">
                            ‚ñ∂ Ch·∫°y <span class="kbd">Ctrl+Enter</span>
                        </button>
                    </div>
                </div>
                <div class="sql-editor-wrapper">
                    <textarea id="sql-editor" placeholder="-- Vi·∫øt SQL query ·ªü ƒë√¢y&#10;-- V√≠ d·ª•: SELECT * FROM cases WHERE difficulty = 1;&#10;-- Nh·∫•n Ctrl+Enter ƒë·ªÉ ch·∫°y"></textarea>
                </div>
                <div class="results-section" id="results-section">
                    <div class="results-header">
                        <h4>üìä K·∫øt qu·∫£</h4>
                        <span class="results-stats" id="results-stats"></span>
                    </div>
                    <div id="results-content">
                        <p style="color: var(--text-dim); text-align: center; padding: 1.5rem;">K·∫øt qu·∫£ s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y...</p>
                    </div>
                </div>
            </section>

            <!-- Schema Reference -->
            <section class="schema-section">
                <div class="schema-header" onclick="toggleSchema()">
                    <h3>üìã S∆° ƒë·ªì Database (Click ƒë·ªÉ m·ªü)</h3>
                    <span id="schema-toggle">‚ñº</span>
                </div>
                <div class="schema-content" id="schema-content">
                    <div class="schema-grid" id="schema-grid"></div>
                </div>
            </section>
        </main>
    </div>

    <footer>
        <p>SQL Mystery Vietnam - D·ª± √°n h·ªçc SQL mi·ªÖn ph√≠ üáªüá≥<br>
        Inspired by <a href="https://mystery.knightlab.com/" target="_blank">SQL Murder Mystery</a></p>
    </footer>

    <script>
        let db = null;
        let currentCase = null;
        let solvedCases = JSON.parse(localStorage.getItem('solvedCases') || '[]');
        let allCases = [];

        // Database schema
        const schemaInfo = {
            'cases': ['id', 'case_number', 'case_type', 'title', 'description', 'location', 'district_id', 'crime_date', 'status', 'difficulty', 'solution_hint'],
            'citizens': ['id', 'name', 'gender', 'birth_date', 'address', 'district_id', 'occupation', 'phone', 'height', 'weight', 'blood_type', 'income_level'],
            'victims': ['id', 'case_id', 'citizen_id', 'injury_type', 'status'],
            'suspects': ['id', 'case_id', 'citizen_id', 'motive', 'alibi'],
            'witnesses': ['id', 'case_id', 'citizen_id', 'testimony', 'reliability'],
            'evidence': ['id', 'case_id', 'evidence_type', 'description', 'location_found', 'analysis_result'],
            'relationships': ['id', 'citizen1_id', 'citizen2_id', 'relationship_type'],
            'criminal_records': ['id', 'citizen_id', 'crime_type', 'conviction_date', 'sentence'],
            'phone_calls': ['id', 'caller_id', 'receiver_id', 'call_date', 'duration_seconds'],
            'bank_transactions': ['id', 'citizen_id', 'transaction_type', 'amount', 'transaction_date', 'location'],
            'gym_members': ['id', 'citizen_id', 'gym_name', 'membership_type'],
            'gym_checkins': ['id', 'member_id', 'checkin_date', 'checkin_time'],
            'vehicles': ['id', 'citizen_id', 'license_plate', 'vehicle_type', 'brand', 'color'],
            'camera_records': ['id', 'camera_id', 'license_plate', 'record_date', 'record_time'],
            'hotel_bookings': ['id', 'hotel_id', 'citizen_id', 'checkin_date', 'checkout_date'],
            'flights': ['id', 'flight_number', 'departure_city', 'arrival_city', 'departure_date'],
            'flight_passengers': ['id', 'flight_id', 'citizen_id', 'seat_number'],
            'employees': ['id', 'citizen_id', 'company_id', 'position', 'department', 'salary'],
            'districts': ['id', 'name', 'city_id'],
            'cities': ['id', 'name', 'region', 'population']
        };

        // Initialize
        async function init() {
            try {
                const SQL = await initSqlJs({
                    locateFile: file => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/${file}`
                });

                const response = await fetch('sql_mystery_vietnam.db');
                const buffer = await response.arrayBuffer();
                db = new SQL.Database(new Uint8Array(buffer));

                loadCases();
                renderSchema();
                updateStats();
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('case-list').innerHTML = `
                    <div class="error-message" style="margin: 1rem;">
                        Kh√¥ng th·ªÉ t·∫£i database.<br>
                        ${error.message}
                    </div>
                `;
            }
        }

        // Load cases
        function loadCases() {
            const results = db.exec("SELECT id, case_number, title, case_type, difficulty FROM cases ORDER BY id");
            if (results.length === 0) return;

            allCases = results[0].values.map(c => ({
                id: c[0], case_number: c[1], title: c[2],
                case_type: c[3], difficulty: c[4]
            }));

            renderCaseList();
        }

        function renderCaseList() {
            const caseList = document.getElementById('case-list');
            caseList.innerHTML = allCases.map(c => {
                const isSolved = solvedCases.includes(c.id);
                return `
                    <div class="case-item ${isSolved ? 'solved' : ''}" data-id="${c.id}" data-difficulty="${c.difficulty}" onclick="selectCase(${c.id})">
                        <div class="case-number">${c.case_number}</div>
                        <div class="case-title">${c.title}</div>
                        <div class="case-meta">
                            <span>${c.case_type}</span>
                            <span class="difficulty">${'‚≠ê'.repeat(c.difficulty)}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Select case
        function selectCase(id) {
            const results = db.exec(`SELECT * FROM cases WHERE id = ${id}`);
            if (results.length === 0) return;

            const columns = results[0].columns;
            const values = results[0].values[0];
            const caseData = {};
            columns.forEach((col, i) => caseData[col] = values[i]);

            currentCase = caseData;
            const isSolved = solvedCases.includes(id);

            // Update sidebar
            document.querySelectorAll('.case-item').forEach(el => el.classList.remove('active'));
            const activeItem = document.querySelector(`.case-item[data-id="${id}"]`);
            if (activeItem) activeItem.classList.add('active');

            // Get culprit name from answers table (hidden)
            const culpritResult = db.exec(`SELECT culprit_name FROM answers WHERE case_id = ${id}`);
            const culpritName = culpritResult.length > 0 ? culpritResult[0].values[0][0] : 'Unknown';

            document.getElementById('case-detail').innerHTML = `
                <div class="case-header">
                    <span class="case-badge">${caseData.case_type}</span>
                    ${isSolved ? '<span class="case-badge" style="background: var(--success); margin-left: 0.5rem;">‚úì ƒê√É PH√Å √ÅN</span>' : ''}
                    <h1>${caseData.title}</h1>
                    <div class="case-info">
                        <div class="info-item">
                            <div class="info-label">M√£ v·ª• √°n</div>
                            <div class="info-value">${caseData.case_number}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Ng√†y x·∫£y ra</div>
                            <div class="info-value">${caseData.crime_date}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">ƒê·ªãa ƒëi·ªÉm</div>
                            <div class="info-value">${caseData.location}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">ƒê·ªô kh√≥</div>
                            <div class="info-value">${'‚≠ê'.repeat(caseData.difficulty)}</div>
                        </div>
                    </div>
                </div>
                
                <div class="case-description">
                    <h3>üìù M√¥ t·∫£ v·ª• √°n</h3>
                    <p>${caseData.description}</p>
                    
                    <details class="hint-box">
                        <summary>üí° G·ª£i √Ω ƒëi·ªÅu tra</summary>
                        <p>${caseData.solution_hint}</p>
                    </details>
                </div>

                <div class="answer-section">
                    <h3>üéØ N·ªôp ƒë√°p √°n - T√™n hung th·ªß</h3>
                    <div class="answer-form">
                        <div class="answer-input-group">
                            <label for="culprit-answer">Nh·∫≠p t√™n ƒë·∫ßy ƒë·ªß c·ªßa hung th·ªß:</label>
                            <input type="text" id="culprit-answer" class="answer-input" 
                                   placeholder="V√≠ d·ª•: Nguy·ªÖn VƒÉn A" 
                                   ${isSolved ? 'disabled value="' + culpritName + '"' : ''}
                                   onkeypress="if(event.key==='Enter')submitAnswer()">
                        </div>
                        <button class="btn-submit-answer" onclick="submitAnswer()" ${isSolved ? 'disabled' : ''}>
                            ${isSolved ? '‚úì ƒê√£ ph√° √°n' : 'üîç Ki·ªÉm tra'}
                        </button>
                    </div>
                    <div class="answer-result" id="answer-result"></div>
                </div>

                <div class="quick-actions">
                    <span class="quick-query" onclick="runQuickQuery('SELECT c.name, v.injury_type, v.status FROM victims v JOIN citizens c ON v.citizen_id = c.id WHERE v.case_id = ${id}')">üë§ N·∫°n nh√¢n</span>
                    <span class="quick-query" onclick="runQuickQuery('SELECT c.name, w.testimony, w.reliability FROM witnesses w JOIN citizens c ON w.citizen_id = c.id WHERE w.case_id = ${id}')">üëÅÔ∏è Nh√¢n ch·ª©ng</span>
                    <span class="quick-query" onclick="runQuickQuery('SELECT evidence_type, description, analysis_result FROM evidence WHERE case_id = ${id}')">üî¨ B·∫±ng ch·ª©ng</span>
                </div>
            `;

            document.getElementById('sql-editor').value = `-- V·ª• √°n #${id}: ${caseData.title}\n-- H√£y d√πng SQL ƒë·ªÉ t√¨m hung th·ªß!\n\nSELECT * FROM suspects WHERE case_id = ${id};`;

            // Mobile: switch to investigate tab
            if (window.innerWidth <= 768) {
                showTab('investigate');
            }
        }

        // Submit answer
        function submitAnswer() {
            if (!currentCase) return;

            const answer = document.getElementById('culprit-answer').value.trim();
            const resultDiv = document.getElementById('answer-result');

            if (!answer) {
                resultDiv.className = 'answer-result show wrong';
                resultDiv.innerHTML = `<h4>‚ö†Ô∏è Vui l√≤ng nh·∫≠p t√™n hung th·ªß</h4>`;
                return;
            }

            // Get correct answer from answers table
            const culpritResult = db.exec(`SELECT culprit_name FROM answers WHERE case_id = ${currentCase.id}`);
            if (culpritResult.length === 0) return;

            const correctName = culpritResult[0].values[0][0];
            
            // Normalize strings for comparison
            const normalize = str => str.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '').replace(/ƒë/g, 'd').replace(/\s+/g, ' ').trim();
            
            const isCorrect = normalize(answer) === normalize(correctName);

            if (isCorrect) {
                resultDiv.className = 'answer-result show correct';
                resultDiv.innerHTML = `
                    <h4>üéâ Ch√≠nh x√°c! B·∫°n ƒë√£ ph√° √°n!</h4>
                    <p>Hung th·ªß l√† <strong>${correctName}</strong>. Tuy·ªát v·ªùi, th√°m t·ª≠!</p>
                `;
                
                markCaseSolved(currentCase.id);
                
                // Disable input
                document.getElementById('culprit-answer').disabled = true;
                document.getElementById('culprit-answer').value = correctName;
                document.querySelector('.btn-submit-answer').disabled = true;
                document.querySelector('.btn-submit-answer').textContent = '‚úì ƒê√£ ph√° √°n';
            } else {
                resultDiv.className = 'answer-result show wrong';
                resultDiv.innerHTML = `
                    <h4>‚ùå Sai r·ªìi!</h4>
                    <p>ƒê√¢y kh√¥ng ph·∫£i hung th·ªß. H√£y ti·∫øp t·ª•c ƒëi·ªÅu tra b·∫±ng SQL!</p>
                `;
            }
        }

        // Mark case as solved
        function markCaseSolved(caseId) {
            if (!solvedCases.includes(caseId)) {
                solvedCases.push(caseId);
                localStorage.setItem('solvedCases', JSON.stringify(solvedCases));
                
                const caseItem = document.querySelector(`.case-item[data-id="${caseId}"]`);
                if (caseItem) caseItem.classList.add('solved');

                updateStats();
            }
        }

        // Update stats
        function updateStats() {
            document.getElementById('solved-count').textContent = solvedCases.length;
            document.getElementById('progress-percent').textContent = Math.round((solvedCases.length / 50) * 100) + '%';
        }

        // Execute SQL
        function executeSQL() {
            const sql = document.getElementById('sql-editor').value.trim();
            if (!sql) return;

            const resultsContent = document.getElementById('results-content');
            const resultsStats = document.getElementById('results-stats');

            try {
                const startTime = performance.now();
                const results = db.exec(sql);
                const endTime = performance.now();

                if (results.length === 0) {
                    resultsContent.innerHTML = '<p style="color: var(--text-dim); text-align: center; padding: 1.5rem;">Query th·ª±c thi th√†nh c√¥ng (0 k·∫øt qu·∫£)</p>';
                    resultsStats.textContent = `${(endTime - startTime).toFixed(2)}ms`;
                    return;
                }

                const { columns, values } = results[0];
                resultsStats.textContent = `${values.length} d√≤ng | ${(endTime - startTime).toFixed(2)}ms`;

                resultsContent.innerHTML = `
                    <div class="results-table-wrapper">
                        <table class="results-table">
                            <thead>
                                <tr>${columns.map(col => `<th>${col}</th>`).join('')}</tr>
                            </thead>
                            <tbody>
                                ${values.map(row => `<tr>${row.map(cell => `<td>${cell === null ? '<span style="color: var(--text-dim)">NULL</span>' : cell}</td>`).join('')}</tr>`).join('')}
                            </tbody>
                        </table>
                    </div>
                `;

            } catch (error) {
                resultsContent.innerHTML = `<div class="error-message">‚ùå L·ªói: ${error.message}</div>`;
                resultsStats.textContent = '';
            }
        }

        // Quick query
        function runQuickQuery(sql) {
            document.getElementById('sql-editor').value = sql;
            executeSQL();
            
            // Mobile: switch to SQL tab
            if (window.innerWidth <= 768) {
                showTab('sql');
            }
        }

        // Clear editor
        function clearEditor() {
            document.getElementById('sql-editor').value = '';
            document.getElementById('results-content').innerHTML = '<p style="color: var(--text-dim); text-align: center; padding: 1.5rem;">K·∫øt qu·∫£ s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y...</p>';
            document.getElementById('results-stats').textContent = '';
        }

        // Toggle schema
        function toggleSchema() {
            const content = document.getElementById('schema-content');
            const toggle = document.getElementById('schema-toggle');
            content.classList.toggle('show');
            toggle.textContent = content.classList.contains('show') ? '‚ñ≤' : '‚ñº';
        }

        // Render schema
        function renderSchema() {
            const grid = document.getElementById('schema-grid');
            grid.innerHTML = Object.entries(schemaInfo).map(([table, columns]) => `
                <div class="schema-table">
                    <div class="schema-table-name">${table}</div>
                    <div class="schema-columns">
                        ${columns.slice(0, 6).map(col => `<div>‚Ä¢ ${col}</div>`).join('')}
                        ${columns.length > 6 ? `<div style="color: var(--text-dim)">+${columns.length - 6} more...</div>` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Filter cases
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('filter-btn')) {
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
                
                const filter = e.target.dataset.filter;
                document.querySelectorAll('.case-item').forEach(item => {
                    if (filter === 'all' || item.dataset.difficulty === filter) {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                });
            }
        });

        // Mobile tabs
        function showTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.tab-btn[data-tab="${tab}"]`).classList.add('active');

            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('main-content');
            const caseDetail = document.getElementById('case-detail');
            const sqlSection = document.getElementById('sql-section');

            sidebar.classList.remove('show');
            mainContent.classList.remove('hidden');
            caseDetail.style.display = 'block';
            sqlSection.style.display = 'block';

            if (tab === 'cases') {
                sidebar.classList.add('show');
            } else if (tab === 'investigate') {
                sqlSection.style.display = 'none';
            } else if (tab === 'sql') {
                caseDetail.style.display = 'none';
            }
        }

        function closeSidebar() {
            document.getElementById('sidebar').classList.remove('show');
            showTab('investigate');
        }

        // Keyboard shortcut
        document.getElementById('sql-editor').addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter') {
                e.preventDefault();
                executeSQL();
            }
        });

        // Initialize
        init();
    </script>
</body>
</html>
